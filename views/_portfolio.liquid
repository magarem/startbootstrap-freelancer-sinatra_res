<style type="text/css">
 .centro {
 /* centraliza na horizontal */
  -ms-justify-content: center;
  -webkit-justify-content: center;
  justify-content: center;  
}
</style>
<script>
  
  var mod = angular.module("myapp", ['ngAnimate', 'ui.bootstrap', 'ngFileUpload', 'angular-medium-editor']);


  mod.factory('Service', function() {
    var Service = {
      images: {{data_portfolio_json}}
    };
    return Service;
  });

  mod.controller('myCtrl', function ($scope, Service, $uibModal, $log) {
      
      $scope.images = Service.images
      
      $scope.currentImage = $scope.images[0];
      $scope.imageCategories = [{{port_cats}}];
      
      $scope.valueSelected = function (value) {

          if (value === null) {
              $scope.catselect = undefined;
          }
      }; 


      $scope.refresh_album = function (value) {
          alert($scope.images[2].image);
         
      }; 
         
      //
      //
      // Modal
      //
      //
      $scope.animationsEnabled = true;

      $scope.mostra = function (x){
        console.log(x);
      }

      $scope.open = function (titulo) {

        var modalInstance = $uibModal.open({
          animation: $scope.animationsEnabled,
          
          windowTopClass: "portfolio-modal modal",
          templateUrl: 'myModalContent.html',
          controller: 'ModalInstanceCtrl',
          size: 'lg',
          resolve: {
            item: function () {
              return titulo;
            }
          }
        });
      };
      $scope.toggleAnimation = function () {
        $scope.animationsEnabled = !$scope.animationsEnabled;
      };
});
// Please note that $uibModalInstance represents a modal window (instance) dependency.
// It is not the same as the $uibModal service used above.

mod.controller('ModalInstanceCtrl', function ($scope, $uibModalInstance, $timeout, item) {
 
  $scope.item = item;

  $scope.ok = function () {
    $uibModalInstance.close($scope.selected.item);

  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  }; 
   
});

mod.controller('MyFormCtrl', ['$scope', 'Upload', '$timeout', 'Service', function ($scope, Upload, $timeout, Service) {

    
    $scope.up = function(){
       angular.element('#file').trigger('click');
    };

    $scope.uploadPic = function(file) {

    if (file == undefined) {

      Upload.upload({
        url: '/{{data}}/portfolio/save',
        data: {item: $scope.item},      
      });
   
    }else{
      $scope.item.img = file.name;
      file.upload = Upload.upload({
        url: '/{{data}}/portfolio/save',
        data: {item: $scope.item, file: file},      
      });
      Service.images[$scope.item.id].img = "img/portfolio/"+file.name;
      console.log(file);
      console.log($scope.item.id);
      console.log($scope.item.img);
    }  

    if (!file == undefined) {
        file.upload.then(function (response) {
          $timeout(function () {file.result = response.data; });
        }, function (response) {
          if (response.status > 0)
            $scope.errorMsg = response.status + ': ' + response.data;
        }, function (evt) {
          // Math.min is to fix IE which reports 200% sometimes
          file.progress = Math.min(100, parseInt(100.0 * evt.loaded / evt.total));
        });
    }

    alert("Documento salvo com sucesso!");
  }
}]);

</script>


<div ng-controller="myCtrl">
 <section id="portfolio" >
    <div class="container">
       <div class="row">
          <div class="col-lg-12 text-center">
              <h2>{{site.pages.portfolio.label}}</h2>
              <hr class="star-primary">                
          </div>
       </div>
      {%raw%} 
       <div class="row">
           <div class="text-center">
             <select ng-model="catselect"
               ng-options="cat for cat in imageCategories"
               ng-change="valueSelected(catselect)">
              <option value>Categoria</option>
             </select>
           </div>
       </div>
       <div class="clearfix"></div>
       <br />
       <style>
          .crop {
            width: 380px;
            height: 240px;
            overflow: hidden;
          }
          .resize-img {
           max-width: 100%;
           height: 240px;
            overflow: hidden;
          }
       </style>
       
        <div class="row"> 
              <div  class="col-sm-4 portfolio-item resize-img" ng-repeat="image in images | filter:(!!catselect || undefined) && {cat: catselect}">               
               
                  <a href=""  class="portfolio-link" ng-click="open(image);mostra($index);">               
                   <div class="caption">
                            <div class="caption-content">
                                <i class="fa fa-search-plus fa-3x"></i>
                            </div>
                        </div>
                    <img  ng-src="{{image.img}}" class="img-responsive centered-and-cropped"  alt="">
                  </a>
              </div>
        </div>
    </div>
  </section>
</div>

<script type="text/ng-template" id="myModalContent.html">
      <div class="modal-body">
         <form name="myForm" ng-controller="MyFormCtrl">
            <h2><div medium-editor ng-model="item.titulo"></div></h2>
            <hr class="star-primary">
            
              <input type="file" 
                   ngf-select 
                   ng-model="picFile" 
                   id="file" 
                   name="file"    
                   accept="image/*" ngf-max-size="2MB" 
                   ngf-model-invalid="errorFile" 
                   style="visibility:hidden">
              <img  ngf-thumbnail="picFile || '{{item.img}}'" class="thumb" 
                  ng-click="up();"> 
              <!-- <button ng-click="picFile = null" ng-show="picFile">Remove</button> -->
             
          <br>
        <p><div medium-editor ng-model="item.txt"></div></p>
        <ul class="list-inline item-details">           
            <li>Cliente:
               <strong>
                <div medium-editor ng-model="item.cliente"></div>
               </strong>
            </li>
            <li>Data:
                <strong>
                 <div medium-editor ng-model="item.data"></div>
                </strong>
            </li>
            <li>Servi√ßo:
                <strong>
                  <div medium-editor ng-model="item.servico"></div>  
                </strong>
            </li>
            <li>Site:
                <strong>
                  <div 
                    medium-editor ng-model="item.site">
                  <a href="http://{{item.site}}">
                  </a>
                  </div>  
                </strong>
            </li>
             <li>Categorias:
                <strong>
                  <div medium-editor ng-model="item.cat"></div>  
                </strong>
            </li>
        </ul>
        <br>
        <i ng-show="myForm.file.$error.maxSize">Imagem muito pesada 
            {{errorFile.size / 1000000|number:1}}MB: max 2M</i>
        <span class="progress" ng-show="picFile.progress >= 0">
          <div style="width:{{picFile.progress}}%" 
              ng-bind="picFile.progress + '%'"></div>
        </span>
        <span ng-show="picFile.result">Dados salvos com sucesso!</span>
        <span class="err" ng-show="errorMsg">{{errorMsg}}</span>
        
        <button type="button" class="btn btn-default" ng-click="uploadPic(picFile);">Salvar</button>
        <button type="button" class="btn btn-default" ng-click="ok();"> ok</button>
        <button type="button" class="btn btn-default" ng-click="cancel();"><i class="fa fa-times"></i> Fechar</button>
    </div>
    </form>
</script>
{%endraw%}
 



